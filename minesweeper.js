"use strict";(function(){var s=Math.floor;function a(a,b,e){if((!1,1!==A[e][b]&&(2!==A[e][b]||0!==a))&&(2===a?A[e][b]=2===A[e][b]?0:2:0===a&&(z[e][b]?B="You lose.":(A[e][b]=1,!c(b,e)&&f(b,e))),99===d())){// If all flags have been placed, check they are valid. if so, win the game
var g=r(z),h=r(A).every(function(a,b){return 2!==a||!0===g[b]});!h||(B="You win")}// Already clicked, or left clicking a flag? Ignore.
}function b(a,b){return[{x:a-1,y:b-1},{x:a,y:b-1},{x:a+1,y:b-1},{x:a-1,y:b},{x:a+1,y:b},{x:a-1,y:b+1},{x:a,y:b+1},{x:a+1,y:b+1}].filter(function(a){var b=a.x,c=a.y;return e(b,c)})}function c(a,c){return b(a,c).reduce(function(b,a){var c=a.x,d=a.y;return b+(z[d][c]?1:0)},0)}function d(){return q(r(A).map(function(a){return 2===a?1:0}))}function e(a,b){return 0<=a&&0<=b&&a<30&&b<16}function f(a,d){// For each neighbour, check it's valid and if it's not revealed, reveal it and reveal it's neighbours if blank
b(a,d).forEach(function(a){var b=a.x,d=a.y;0===A[d][b]&&(A[d][b]=1,!c(b,d)&&f(b,d))})}function g(a,b){var c=a-50,d=b-100;if(c%32>25||d%32>25)return null;// In margins
var f=s(c/32),g=s(d/32);return e(f,g)?[f,g]:null;// Outside of grid
}function h(a){var b=a.pageX-t.offsetLeft,c=a.pageY-t.offsetTop,d=g(b,c);d!==D||(// Todo finish click detection system
i(b,c),C)}function i(b,c,d){// ^ if the position in the grid cell is greater than the size of the square in the cell
a(d,squareX,squareY)}function j(){console.log("Long click!")}// Render functions
function k(){u.clearRect(0,0,w,v),n(),l(50,100),o(),requestAnimationFrame(k)}function l(a,b){for(var e=0;e<16;e++)for(var f=0;f<30;f++){var c=f*32+a,d=e*32+b;m(f,e,c,d)}}function m(a,b,d,e){var f=z[b][a],g=A[b][a];switch(u.font="24px monospace",g){case 0:u.fillStyle="grey",u.fillRect(d,e,25,25);break;case 1:u.strokeRect(d,e,25,25);var h=c(a,b);u.fillStyle="black",u.fillText(h||"",d+5,e+20);break;case 2:u.fillStyle="black",u.fillText("\uD83C\uDFF3",d+3,e+20);}}function n(){u.fillStyle="black",u.font="36px sans-serif";var a=Math.round((Date.now()-x)/1e3),b=s(a/60)+":"+("0"+a%60).slice(-2),c="Time: ".concat(b,"  - \uD83C\uDFF3: ").concat(99-d());u.fillText(c,100,50)}function o(){if(B){u.font="50px sans-serif";var a=u.measureText(B).width;u.fillStyle="white",u.fillRect(330-a/2,300,a+50,70),u.fillStyle="black",u.fillText(B,350-a/2,355)}}// Event handlers
// Helper functions
function p(b){for(var d=b.length-1;0<d;d--){var a=s(Math.random()*(d+1)),c=[b[a],b[d]];b[d]=c[0],b[a]=c[1]}return b}function q(a){return a.reduce(function(c,a){return c+a},0)}function r(a){return a.reduce(function(b,a){return b.concat(a)},[])}// Configurable variables
var t=document.getElementById("game"),u=t.getContext("2d"),v=t.height,w=t.width,x=0,z=[],A=[],B="",C=null,D=null;// Start the game
t.addEventListener("mousedown",function(a){var b=a.pageX-t.offsetLeft,c=a.pageY-t.offsetTop;D=g(b,c),setTimeout(function(){return j(b,c)},500)}),t.addEventListener("mouseup",h),t.addEventListener("contextmenu",function(a){a.preventDefault()}),// Game functions
function(a,b,c){x=Date.now();// Create an array with randomly placed mines
for(var d=p(Array(b*a).fill(!1,0,b*a-c).fill(!0,b*a-c)),e=0;e<b;e++)// Place into a 2d array, to setup state & solution
A[e]=Array(a).fill(0),z[e]=d.slice(e*a,e*a+a)}(30,16,99),!1&&function(){console.log(z.map(function(a){return a.map(function(a){return a?"*":"-"}).join(" ")}).join("\n"))}(),k()})();